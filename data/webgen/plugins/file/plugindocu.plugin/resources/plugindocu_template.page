--- content, pipeline:erb;blocks;tags;fragments

<h2 id="general">General Information</h2>

<%
require 'cgi'
plugin_name = node.node_info[:plugin_for_docu]
infos = @plugin_manager.plugin_infos[plugin_name]
plugin = @plugin_manager[plugin_name]

row = lambda {|desc, value| "<tr style='vertical-align: top'><th>#{CGI::escapeHTML( desc )}:</th><td>#{value}</td></tr>" }
ancestors = plugin.plugin_ancestors.collect {|k| k.plugin_name}.join(', ')
dependencies = ([infos['plugin']['load_deps']] + [infos['plugin']['run_deps']]).flatten.uniq.sort.join(', ')
path_patterns = @plugin_manager['File/DefaultHandler'].static_path_patterns( plugin_name ) || []

def format_params( params )
  params.sort.collect do |k,v|
    "<p class='param'><span class='param-name'>#{k}</span>" + \
    ( v['mandatory'].nil? ? "" : " (=" + ( v['mandatory'] == 'default' ? "default ": "" ) + "mandatory parameter)" ) + \
        ":&nbsp;<span class='param-default-value'>#{CGI::escapeHTML( v['default'].inspect )}</span>" + \
        "<br /><span class='param-description'>#{CGI::escapeHTML( v['desc'] )}</span></p>"
  end.join( "\n" )
end
%>

<table class='plugin-info'>
<%= row['Plugin name', CGI::escapeHTML( plugin_name + (ancestors.empty? ? '' : " (#{ancestors})" ) )] %>
<%= [['Author', 'author'], ['Summary', 'summary'], ['Description', 'description']].collect do |desc, name|
      row[desc, CGI::escapeHTML( infos['about'][name] )] if infos['about'][name]
    end.join("\n") %>

<%= dependencies.empty? ? '' : row['Dependencies', CGI::escapeHTML( dependencies )] %>

<% unless infos['params'].empty? %>
<%= row['Parameters', format_params( infos['params'] )] %>
<% end %>

<%= infos['tags'] ? row['Handled tags', ([infos['tags']].flatten.collect {|t| t == :default ? "Default tag" : t}.join(', '))] : '' %>
<%= infos['processes'] ? row['Processor name', infos['processes']] : '' %>
<%= path_patterns.empty? ? '' : row['Handled paths', path_patterns.collect {|rank, path| CGI::escapeHTML( path )}.join('<br />')] %>

<%= (mi = infos['file'] && infos['file']['meta_info'] ) ? row['Default Meta Information', "<pre>" + CGI::escapeHTML( mi.to_yaml.sub( /\A---\s*\n/m, '') ) + "</pre>"] : '' %>

</table>

<% if node.node_info[:page].blocks['documentation'] %>
<webgen:block name="documentation" />
<% end %>
