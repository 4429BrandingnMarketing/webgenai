# -*- ruby -*-

simple_tag( 'version' ) do |tag, node, refNode|
  Webgen::VERSION.join( '.' )
end

class FileHandlerTag < Tags::DefaultTag

  plugin "File Handler Tag"
  summary "Shows options for the specified file handler"

  def initialize
    super
    @processOutput = false
  end

  def check_mandatory_param( param )
    param.kind_of?( String )
  end

  def process_tag( tag, node, refNode )
    filehandler = get_param( :mandatory )
    self.logger.debug { "Describing tag #{filehandler}" }
    format_data( Webgen::Plugin.config.find {|k,v| v.plugin == filehandler }[1] )
  end

  def format_data( data )
    s = "<table>"
    row = lambda {|desc, value| "<tr style='vertical-align: top'><td style='font-weight:bold'>#{desc}:</td><td>#{value}</td></tr>" }

    [['Plugin Name', 'plugin'], ['Summary', 'summary'], ['Description', 'description']].each do |desc, name|
      s += row[desc, data.send( name )] if eval( "data.#{name}" )
    end

    s += row['Dependencies', data.dependencies.join( ', ')] if data.dependencies

    if data.params
      params = data.params.collect do |k,v|
        "<span style='color: red'>#{v.name}</span>&nbsp;=&nbsp;" \
        "<span style='color: blue'>#{v.default.inspect}</span><br />\n#{v.description}"
      end.join( "<br /><br />\n" )
      s += row['Parameters', params]
    end

    s += "</table>"
  end

end

register_tag( 'describe', FileHandlerTag.new )

